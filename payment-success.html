<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EventHub - Booking Confirmed!</title>

    <!-- Bootstrap 5.3 CSS (Latest) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Bootstrap Icons (Latest) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- QR Code Generator -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>

<body>
    <!-- EventHub Header - Authenticated -->
    <nav class="navbar navbar-expand-lg eventhub-navbar">
        <div class="container-fluid px-4">
            <!-- Brand Logo -->
            <a class="navbar-brand eventhub-brand d-flex align-items-center" href="index.html">
                <div class="brand-icon me-2">
                    <i class="bi bi-calendar-event me-1"></i>
                </div>
                <span class="brand-text">EventHub</span>
            </a>

            <!-- Mobile Toggle Button -->
            <button class="navbar-toggler custom-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navigation Items -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Left Navigation -->
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link eventhub-nav-link" href="index.html">
                            <i class="bi bi-house-fill me-1"></i>
                            Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link eventhub-nav-link" href="event-listing.html">
                            <i class="bi bi-calendar3 me-1"></i>Events
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link eventhub-nav-link" href="my-bookings.html">
                            <i class="bi bi-ticket-perforated me-1"></i>My Bookings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link eventhub-nav-link" href="my-tickets.html">
                            <i class="bi bi-qr-code me-1"></i>My Tickets
                        </a>
                    </li>
                </ul>

                <!-- Right Navigation - User Menu -->
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle user-menu" href="#" id="userDropdown" role="button" 
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <div class="user-avatar">
                                <i class="bi bi-person-circle"></i>
                            </div>
                            <span class="user-name" id="userName">Priya Fernando</span>
                        </a>
                        <ul class="dropdown-menu user-dropdown" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item" href="customer-dashboard.html">
                                <i class="bi bi-speedometer2 me-2"></i>Dashboard</a></li>
                            <li><a class="dropdown-item" href="user-profile.html">
                                <i class="bi bi-person me-2"></i>Edit Profile</a></li>
                            <li><a class="dropdown-item" href="my-bookings.html">
                                <i class="bi bi-ticket-perforated me-2"></i>My Bookings</a></li>
                            <li><a class="dropdown-item" href="payment-history.html">
                                <i class="bi bi-credit-card me-2"></i>Payment History</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">
                                <i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Success Header -->
    <section class="success-header">
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-lg-8 text-center">
                    <div class="success-animation">
                        <div class="checkmark-circle">
                            <div class="checkmark"></div>
                        </div>
                    </div>
                    <h1 class="success-title">Booking Confirmed!</h1>
                    <p class="success-subtitle">Your tickets have been successfully purchased</p>
                    <div class="booking-reference">
                        <span class="ref-label">Booking Reference:</span>
                        <span class="ref-number" id="bookingReference">BK202512251234567</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="success-content py-5">
        <div class="container-fluid">
            <div class="row g-4">
                <!-- Left Column - Event & Booking Details -->
                <div class="col-lg-8">
                    <!-- Booking Summary -->
                    <div class="success-card mb-4">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="bi bi-calendar-check me-2"></i>Event Details
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="event-summary">
                                <div class="event-image">
                                    <img id="eventImage" src="picture/event-jazz.jpg" alt="Event Image" class="img-fluid">
                                </div>
                                <div class="event-info">
                                    <h4 id="eventTitle">Jazz Night Under Stars</h4>
                                    <div class="event-details">
                                        <div class="detail-item">
                                            <i class="bi bi-calendar3"></i>
                                            <div>
                                                <strong id="eventDate">Saturday, January 30, 2025</strong>
                                                <small id="eventTime">8:00 PM - 11:00 PM</small>
                                            </div>
                                        </div>
                                        <div class="detail-item">
                                            <i class="bi bi-geo-alt"></i>
                                            <div>
                                                <strong id="eventVenue">Royal Botanical Gardens, Kandy</strong>
                                                <small>Kandy, Sri Lanka</small>
                                            </div>
                                        </div>
                                        <div class="detail-item">
                                            <i class="bi bi-person"></i>
                                            <div>
                                                <strong id="eventOrganizer">Music Events Lanka</strong>
                                                <small>Event Organizer</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ticket Details -->
                    <div class="success-card mb-4">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="bi bi-ticket-perforated me-2"></i>Your Tickets
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="ticketsList" class="tickets-list">
                                <!-- Tickets will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Payment Summary -->
                    <div class="success-card mb-4">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="bi bi-receipt me-2"></i>Payment Summary
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="payment-summary">
                                <div class="payment-method-info">
                                    <div class="payment-icon" id="paymentMethodIcon">
                                        <i class="bi bi-credit-card"></i>
                                    </div>
                                    <div class="payment-details">
                                        <h6 id="paymentMethodName">Credit/Debit Card</h6>
                                        <p id="paymentMethodDetails">Payment processed successfully</p>
                                        <small class="text-success">
                                            <i class="bi bi-check-circle me-1"></i>
                                            <span id="paymentStatus">Confirmed</span>
                                        </small>
                                    </div>
                                </div>

                                <div class="price-breakdown">
                                    <div class="price-row">
                                        <span>Subtotal</span>
                                        <span id="subtotalAmount">Rs. 7,000</span>
                                    </div>
                                    <div class="price-row" id="discountRow" style="display: none;">
                                        <span class="text-success">Discount Applied</span>
                                        <span class="text-success" id="discountAmount">-Rs. 0</span>
                                    </div>
                                    <div class="price-row" id="pointsRow" style="display: none;">
                                        <span class="text-success">Loyalty Points Used</span>
                                        <span class="text-success" id="pointsAmount">-Rs. 0</span>
                                    </div>
                                    <div class="price-row">
                                        <span>Service Fee</span>
                                        <span id="serviceFeeAmount">Rs. 350</span>
                                    </div>
                                    <div class="price-row">
                                        <span>Processing Fee</span>
                                        <span id="processingFeeAmount">Rs. 150</span>
                                    </div>
                                    <hr>
                                    <div class="price-row total">
                                        <strong>Total Paid</strong>
                                        <strong id="totalPaidAmount">Rs. 7,500</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Important Information -->
                    <div class="success-card">
                        <div class="card-header">
                            <h5 class="card-title">
                                <i class="bi bi-info-circle me-2"></i>Important Information
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="important-info">
                                <div class="info-section">
                                    <h6><i class="bi bi-qr-code me-2"></i>Digital Tickets</h6>
                                    <ul>
                                        <li>Your e-tickets with QR codes are ready for use</li>
                                        <li>Present QR codes at the venue entrance for scanning</li>
                                        <li>Tickets are valid for the specified date and time only</li>
                                        <li>Screenshots of QR codes are also accepted</li>
                                    </ul>
                                </div>

                                <div class="info-section">
                                    <h6><i class="bi bi-envelope me-2"></i>Email Confirmation</h6>
                                    <ul>
                                        <li>Confirmation email sent to <strong id="customerEmail">priya.fernando@email.com</strong></li>
                                        <li>Email includes PDF tickets and event details</li>
                                        <li>Check spam folder if email not received within 5 minutes</li>
                                    </ul>
                                </div>

                                <div class="info-section">
                                    <h6><i class="bi bi-arrow-clockwise me-2"></i>Cancellation Policy</h6>
                                    <ul>
                                        <li>Tickets can be cancelled up to 48 hours before the event</li>
                                        <li>Refunds will be processed within 5-7 business days</li>
                                        <li>Processing fees are non-refundable</li>
                                        <li>Contact support for cancellation requests</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Digital Tickets & Actions -->
                <div class="col-lg-4">
                    <!-- QR Tickets -->
                    <div class="ticket-card mb-4">
                        <div class="ticket-header">
                            <h5>Your Digital Tickets</h5>
                            <div class="ticket-count">
                                <span id="ticketCount">2</span> Ticket(s)
                            </div>
                        </div>
                        <div class="ticket-body">
                            <div id="digitalTickets" class="digital-tickets">
                                <!-- Digital tickets with QR codes will be generated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="action-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title">Quick Actions</h6>
                        </div>
                        <div class="card-body">
                            <div class="action-buttons">
                                <button class="btn btn-primary w-100 mb-3" onclick="downloadTickets()">
                                    <i class="bi bi-download me-2"></i>
                                    Download Tickets (PDF)
                                </button>
                                
                                <button class="btn btn-outline-primary w-100 mb-3" onclick="emailTickets()">
                                    <i class="bi bi-envelope me-2"></i>
                                    Email Tickets
                                </button>
                                
                                <button class="btn btn-outline-secondary w-100 mb-3" onclick="addToCalendar()">
                                    <i class="bi bi-calendar-plus me-2"></i>
                                    Add to Calendar
                                </button>
                                
                                <button class="btn btn-outline-success w-100 mb-3" onclick="shareEvent()">
                                    <i class="bi bi-share me-2"></i>
                                    Share Event
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Actions -->
                    <div class="navigation-card">
                        <div class="card-body">
                            <div class="nav-actions">
                                <a href="my-bookings.html" class="btn btn-success w-100 mb-3">
                                    <i class="bi bi-ticket-perforated me-2"></i>
                                    View All My Bookings
                                </a>
                                
                                <a href="my-tickets.html" class="btn btn-outline-success w-100 mb-3">
                                    <i class="bi bi-qr-code me-2"></i>
                                    My Digital Tickets
                                </a>
                                
                                <a href="event-listing.html" class="btn btn-outline-primary w-100 mb-3">
                                    <i class="bi bi-search me-2"></i>
                                    Browse More Events
                                </a>
                                
                                <a href="customer-dashboard.html" class="btn btn-outline-secondary w-100">
                                    <i class="bi bi-speedometer2 me-2"></i>
                                    Back to Dashboard
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Loyalty Points Earned -->
                    <div class="loyalty-card mt-4">
                        <div class="loyalty-content">
                            <div class="loyalty-icon">
                                <i class="bi bi-star-fill"></i>
                            </div>
                            <div class="loyalty-info">
                                <h6>Points Earned!</h6>
                                <p>You earned <strong id="pointsEarned">75</strong> loyalty points</p>
                                <small>Use points for discounts on future bookings</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <style>
        /* EventHub Custom Styles */
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
            line-height: 1.6;
        }

        /* Navbar Styling - Authenticated */
        .eventhub-navbar {
            background-color: #ffffff;
            border-bottom: 1px solid #e9ecef;
            padding: 0.75rem 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .eventhub-brand {
            text-decoration: none;
            color: #6366f1 !important;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .eventhub-brand:hover {
            color: #5855eb !important;
            text-decoration: none;
        }

        .brand-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .brand-text {
            color: #6366f1;
            font-weight: 700;
        }

        .eventhub-nav-link {
            color: #64748b !important;
            font-weight: 500;
            font-size: 0.95rem;
            padding: 0.5rem 1rem !important;
            margin: 0 0.25rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
        }

        .eventhub-nav-link:hover {
            color: #6366f1 !important;
            background-color: rgba(99, 102, 241, 0.1);
        }

        .eventhub-nav-link.active {
            color: #6366f1 !important;
            background-color: rgba(99, 102, 241, 0.15);
            font-weight: 600;
        }

        /* User Menu */
        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem !important;
            border-radius: 50px;
            background: rgba(99, 102, 241, 0.1);
            color: #6366f1 !important;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .user-menu:hover {
            background: rgba(99, 102, 241, 0.15);
            color: #6366f1 !important;
        }

        .user-avatar {
            font-size: 1.5rem;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-dropdown {
            border-radius: 1rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            border: 1px solid #e2e8f0;
            padding: 0.5rem;
            min-width: 220px;
        }

        .user-dropdown .dropdown-item {
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.25rem;
            transition: all 0.2s ease;
        }

        .user-dropdown .dropdown-item:hover {
            background-color: rgba(99, 102, 241, 0.1);
            color: #6366f1;
        }

        .user-dropdown .dropdown-item.active {
            background-color: rgba(99, 102, 241, 0.15);
            color: #6366f1;
            font-weight: 600;
        }

        .custom-toggler {
            border: none;
            padding: 0.25rem 0.5rem;
        }

        .custom-toggler:focus {
            box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
        }

        /* Success Header */
        .success-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 3rem 0;
            text-align: center;
        }

        .success-animation {
            margin-bottom: 2rem;
        }

        .checkmark-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleIn 0.6s ease-out;
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .checkmark {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #10b981;
            font-size: 2rem;
            font-weight: 700;
        }

        .checkmark::before {
            content: '✓';
            animation: checkmarkDraw 0.6s ease-out 0.3s both;
        }

        .success-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            animation: slideInUp 0.6s ease-out 0.2s both;
        }

        .success-subtitle {
            font-size: 1.25rem;
            opacity: 0.9;
            margin-bottom: 2rem;
            animation: slideInUp 0.6s ease-out 0.4s both;
        }

        .booking-reference {
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem 2rem;
            border-radius: 50px;
            display: inline-block;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideInUp 0.6s ease-out 0.6s both;
        }

        .ref-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-right: 1rem;
        }

        .ref-number {
            font-weight: 700;
            font-size: 1.1rem;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }

        /* Success Content Cards */
        .success-card,
        .ticket-card,
        .action-card,
        .navigation-card,
        .loyalty-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f5f9;
            overflow: hidden;
        }

        .card-header {
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            padding: 1.5rem;
        }

        .card-title {
            color: #374151;
            font-weight: 600;
            margin: 0;
            font-size: 1.1rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Event Summary */
        .event-summary {
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
        }

        .event-image {
            flex-shrink: 0;
            width: 150px;
            height: 150px;
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .event-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .event-info h4 {
            color: #374151;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .event-details {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .detail-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .detail-item i {
            color: #6366f1;
            font-size: 1.25rem;
            margin-top: 0.25rem;
            flex-shrink: 0;
        }

        .detail-item strong {
            display: block;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .detail-item small {
            color: #64748b;
            font-size: 0.9rem;
        }

        /* Tickets List */
        .tickets-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .ticket-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
        }

        .ticket-type {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .ticket-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
        }

        .ticket-details h6 {
            color: #374151;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }

        .ticket-details p {
            color: #64748b;
            margin: 0;
            font-size: 0.9rem;
        }

        .ticket-price {
            text-align: right;
        }

        .ticket-price .price {
            color: #374151;
            font-weight: 600;
            font-size: 1.1rem;
            display: block;
        }

        .ticket-price .quantity {
            color: #64748b;
            font-size: 0.85rem;
        }

        /* Payment Summary */
        .payment-method-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
        }

        .payment-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .payment-details h6 {
            color: #374151;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .payment-details p {
            color: #64748b;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .price-breakdown {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            color: #64748b;
        }

        .price-row.total {
            padding-top: 1rem;
            font-size: 1.1rem;
            color: #374151;
        }

        /* Important Information */
        .important-info {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .info-section h6 {
            color: #374151;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .info-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .info-section li {
            padding: 0.5rem 0;
            color: #64748b;
            position: relative;
            padding-left: 1.5rem;
        }

        .info-section li::before {
            content: '•';
            color: #6366f1;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* Digital Tickets */
        .ticket-card .ticket-header {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }

        .ticket-header h5 {
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .ticket-count {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .ticket-body {
            padding: 1.5rem;
        }

        .digital-tickets {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .digital-ticket {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px dashed #e2e8f0;
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .digital-ticket::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6, #ec4899, #f59e0b);
        }

        .ticket-qr {
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
            background: white;
            border-radius: 0.5rem;
            padding: 0.5rem;
            border: 2px solid #e2e8f0;
        }

        .ticket-qr canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .ticket-info {
            text-align: center;
        }

        .ticket-info h6 {
            color: #374151;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .ticket-info p {
            color: #64748b;
            margin: 0.25rem 0;
            font-size: 0.9rem;
        }

        .ticket-info .ticket-id {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #6b7280;
            letter-spacing: 1px;
        }

        /* Action Buttons */
        .action-buttons .btn {
            font-weight: 500;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }

        .action-buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Navigation Actions */
        .nav-actions .btn {
            font-weight: 500;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .nav-actions .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-decoration: none;
        }

        /* Loyalty Card */
        .loyalty-card {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            border-radius: 1rem;
            overflow: hidden;
        }

        .loyalty-content {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .loyalty-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .loyalty-info h6 {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: white;
        }

        .loyalty-info p {
            margin-bottom: 0.25rem;
            color: white;
            opacity: 0.9;
        }

        .loyalty-info small {
            color: white;
            opacity: 0.8;
            font-size: 0.85rem;
        }

        /* Animations */
        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes checkmarkDraw {
            from {
                opacity: 0;
                transform: scale(0);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5855eb 0%, #7c3aed 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
        }

        .btn-outline-primary {
            border: 2px solid #6366f1;
            color: #6366f1;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background: #6366f1;
            color: white;
        }

        .btn-outline-secondary {
            border: 2px solid #6b7280;
            color: #6b7280;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-secondary:hover {
            background: #6b7280;
            color: white;
        }

        .btn-outline-success {
            border: 2px solid #10b981;
            color: #10b981;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-success:hover {
            background: #10b981;
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 991.98px) {
            .navbar-collapse {
                margin-top: 1rem;
                padding: 1rem;
                background-color: white;
                border-radius: 12px;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                border: 1px solid #e2e8f0;
            }

            .eventhub-nav-link {
                padding: 0.75rem 1rem !important;
                margin: 0.25rem 0;
            }

            .user-menu {
                width: 100%;
                justify-content: center;
                margin-top: 1rem;
                border-top: 1px solid #e2e8f0;
                padding-top: 1rem !important;
            }

            .success-title {
                font-size: 2.5rem;
            }

            .event-summary {
                flex-direction: column;
                text-align: center;
            }

            .event-image {
                width: 100%;
                height: 200px;
            }

            .important-info {
                gap: 1.5rem;
            }

            .payment-method-info {
                flex-direction: column;
                text-align: center;
            }

            .loyalty-content {
                flex-direction: column;
                text-align: center;
            }
        }

        @media (max-width: 576px) {
            .success-header {
                padding: 2rem 0;
            }

            .success-title {
                font-size: 2rem;
            }

            .checkmark-circle {
                width: 100px;
                height: 100px;
            }

            .checkmark {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }

            .card-header,
            .card-body,
            .ticket-body {
                padding: 1rem;
            }

            .detail-item {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }

            .ticket-item {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .digital-ticket {
                padding: 1rem;
            }

            .ticket-qr {
                width: 100px;
                height: 100px;
            }
        }

        /* Print Styles */
        @media print {
            .navbar,
            .action-card,
            .navigation-card,
            .loyalty-card {
                display: none;
            }

            body {
                background: white;
            }

            .success-header {
                background: #10b981;
                color: white;
                --print-color-adjust: exact;
            }

            .success-card,
            .ticket-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }

            .digital-ticket {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
    </style>

    <script>
        // Current user and booking data
        let currentUser = null;
        let bookingData = null;

        // Sample booking data for demo
        const sampleBookingData = {
            bookingId: 'BK202512251234567',
            eventId: 1,
            eventTitle: 'Jazz Night Under Stars',
            eventDate: '2025-01-30',
            eventTime: '8:00 PM - 11:00 PM',
            eventVenue: 'Royal Botanical Gardens, Kandy',
            eventImage: 'picture/event-jazz.jpg',
            eventOrganizer: 'Music Events Lanka',
            tickets: [
                {
                    type: 'VIP',
                    price: 4500,
                    quantity: 1,
                    description: 'Premium seating with complimentary drinks',
                    ticketId: 'VIP-001'
                },
                {
                    type: 'Regular',
                    price: 2500,
                    quantity: 1,
                    description: 'Standard seating',
                    ticketId: 'REG-002'
                }
            ],
            paymentMethod: 'card',
            paymentStatus: 'confirmed',
            subtotal: 7000,
            discount: 0,
            pointsUsed: 0,
            serviceFee: 350,
            processingFee: 150,
            totalPaid: 7500,
            customerEmail: 'priya.fernando@email.com',
            bookingDate: new Date().toISOString()
        };

        document.addEventListener('DOMContentLoaded', function () {
            initializeSuccessPage();
            loadBookingData();
            generateDigitalTickets();
            setupEventListeners();
            showSuccessNotification();
        });

        function initializeSuccessPage() {
            // Check if user is logged in
            const sessionData = localStorage.getItem('userSession') || sessionStorage.getItem('userSession');
            
            if (!sessionData) {
                window.location.href = 'login.html?redirect=payment-success.html';
                return;
            }

            currentUser = JSON.parse(sessionData);

            // Get booking ID from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const bookingId = urlParams.get('booking');
            
            if (!bookingId) {
                // If no booking ID, generate one and use sample data
                const generatedId = 'BK' + Date.now() + Math.random().toString(36).substr(2, 5).toUpperCase();
                bookingData = { ...sampleBookingData, bookingId: generatedId };
            } else {
                // Try to load from storage, fallback to sample data
                bookingData = loadBookingFromStorage(bookingId) || { ...sampleBookingData, bookingId: bookingId };
            }

            // Update user name in navbar
            if (currentUser && currentUser.name) {
                document.getElementById('userName').textContent = currentUser.name;
            }

            // Update customer email
            if (currentUser && currentUser.email) {
                bookingData.customerEmail = currentUser.email;
            }
        }

        function loadBookingFromStorage(bookingId) {
            // Try to get booking data from localStorage
            const bookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
            return bookings.find(booking => booking.bookingId === bookingId);
        }

        function loadBookingData() {
            if (!bookingData) return;

            // Ensure all required fields have fallback values
            const safeBookingData = {
                bookingId: bookingData.bookingId || 'BK' + Date.now(),
                eventTitle: bookingData.eventTitle || 'Event Title',
                eventDate: bookingData.eventDate || '2025-01-30',
                eventTime: bookingData.eventTime || '8:00 PM - 11:00 PM',
                eventVenue: bookingData.eventVenue || 'Venue Location',
                eventImage: bookingData.eventImage || 'pictures/events/default-event.jpg',
                eventOrganizer: bookingData.eventOrganizer || 'Event Organizer',
                customerEmail: bookingData.customerEmail || (currentUser ? currentUser.email : 'customer@email.com'),
                tickets: bookingData.tickets || [
                    {
                        type: 'Regular',
                        price: 2500,
                        quantity: 1,
                        description: 'Standard seating',
                        ticketId: 'REG-001'
                    }
                ],
                subtotal: bookingData.subtotal || 2500,
                serviceFee: bookingData.serviceFee || 350,
                processingFee: bookingData.processingFee || 150,
                totalPaid: bookingData.totalPaid || 3000,
                paymentMethod: bookingData.paymentMethod || 'card',
                paymentStatus: bookingData.paymentStatus || 'confirmed',
                discount: bookingData.discount || 0,
                pointsUsed: bookingData.pointsUsed || 0
            };

            // Update booking reference
            document.getElementById('bookingReference').textContent = safeBookingData.bookingId;

            // Update event details
            document.getElementById('eventImage').src = safeBookingData.eventImage;
            document.getElementById('eventTitle').textContent = safeBookingData.eventTitle;
            document.getElementById('eventDate').textContent = formatEventDate(safeBookingData.eventDate);
            document.getElementById('eventTime').textContent = safeBookingData.eventTime;
            document.getElementById('eventVenue').textContent = safeBookingData.eventVenue;
            document.getElementById('eventOrganizer').textContent = safeBookingData.eventOrganizer;

            // Update customer email
            document.getElementById('customerEmail').textContent = safeBookingData.customerEmail;

            // Load tickets with safe data
            loadTicketsWithSafeData(safeBookingData.tickets);

            // Load payment summary with safe data
            loadPaymentSummaryWithSafeData(safeBookingData);

            // Calculate ticket count
            const totalTickets = safeBookingData.tickets.reduce((sum, ticket) => sum + ticket.quantity, 0);
            document.getElementById('ticketCount').textContent = totalTickets;

            // Calculate points earned (1 point per Rs. 100 spent)
            const pointsEarned = Math.floor(safeBookingData.totalPaid / 100);
            document.getElementById('pointsEarned').textContent = pointsEarned;

            // Update bookingData reference for other functions
            bookingData = safeBookingData;
        }

        function loadTicketsWithSafeData(tickets) {
            const container = document.getElementById('ticketsList');
            
            container.innerHTML = tickets.map(ticket => `
                <div class="ticket-item fade-in">
                    <div class="ticket-type">
                        <div class="ticket-icon">
                            <i class="bi bi-ticket-perforated"></i>
                        </div>
                        <div class="ticket-details">
                            <h6>${ticket.type} Ticket</h6>
                            <p>${ticket.description}</p>
                        </div>
                    </div>
                    <div class="ticket-price">
                        <span class="price">Rs. ${ticket.price.toLocaleString()}</span>
                        <span class="quantity">Qty: ${ticket.quantity}</span>
                    </div>
                </div>
            `).join('');
        }

        function loadPaymentSummaryWithSafeData(data) {
            // Update payment method info
            const paymentMethods = {
                card: {
                    name: 'Credit/Debit Card',
                    icon: 'bi-credit-card',
                    details: 'Payment processed successfully'
                },
                paypal: {
                    name: 'PayPal',
                    icon: 'bi-paypal',
                    details: 'PayPal payment completed'
                },
                bank: {
                    name: 'Bank Transfer',
                    icon: 'bi-bank',
                    details: 'Transfer received and confirmed'
                }
            };

            const method = paymentMethods[data.paymentMethod] || paymentMethods.card;
            
            document.getElementById('paymentMethodIcon').innerHTML = `<i class="bi ${method.icon}"></i>`;
            document.getElementById('paymentMethodName').textContent = method.name;
            document.getElementById('paymentMethodDetails').textContent = method.details;
            document.getElementById('paymentStatus').textContent = data.paymentStatus === 'confirmed' ? 'Confirmed' : 'Pending';

            // Update price breakdown
            document.getElementById('subtotalAmount').textContent = `Rs. ${data.subtotal.toLocaleString()}`;
            document.getElementById('serviceFeeAmount').textContent = `Rs. ${data.serviceFee.toLocaleString()}`;
            document.getElementById('processingFeeAmount').textContent = `Rs. ${data.processingFee.toLocaleString()}`;
            document.getElementById('totalPaidAmount').textContent = `Rs. ${data.totalPaid.toLocaleString()}`;

            // Show discount if applied
            if (data.discount > 0) {
                document.getElementById('discountRow').style.display = 'flex';
                document.getElementById('discountAmount').textContent = `-Rs. ${data.discount.toLocaleString()}`;
            }

            // Show points used if any
            if (data.pointsUsed > 0) {
                document.getElementById('pointsRow').style.display = 'flex';
                document.getElementById('pointsAmount').textContent = `-Rs. ${data.pointsUsed.toLocaleString()}`;
            }
        }

        function formatEventDate(dateString) {
            if (!dateString) return 'Date TBD';
            
            try {
                // Handle different date formats
                let date;
                if (dateString.includes('T')) {
                    date = new Date(dateString);
                } else {
                    // Assume YYYY-MM-DD format
                    date = new Date(dateString + 'T00:00:00');
                }
                
                if (isNaN(date.getTime())) {
                    return 'Date TBD';
                }
                
                return date.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                console.error('Date formatting error:', error);
                return 'Date TBD';
            }
        }

        function loadTickets() {
            const container = document.getElementById('ticketsList');
            
            container.innerHTML = bookingData.tickets.map(ticket => `
                <div class="ticket-item fade-in">
                    <div class="ticket-type">
                        <div class="ticket-icon">
                            <i class="bi bi-ticket-perforated"></i>
                        </div>
                        <div class="ticket-details">
                            <h6>${ticket.type} Ticket</h6>
                            <p>${ticket.description}</p>
                        </div>
                    </div>
                    <div class="ticket-price">
                        <span class="price">Rs. ${ticket.price.toLocaleString()}</span>
                        <span class="quantity">Qty: ${ticket.quantity}</span>
                    </div>
                </div>
            `).join('');
        }

        function loadPaymentSummary() {
            // Update payment method info
            const paymentMethods = {
                card: {
                    name: 'Credit/Debit Card',
                    icon: 'bi-credit-card',
                    details: 'Payment processed successfully'
                },
                paypal: {
                    name: 'PayPal',
                    icon: 'bi-paypal',
                    details: 'PayPal payment completed'
                },
                bank: {
                    name: 'Bank Transfer',
                    icon: 'bi-bank',
                    details: 'Transfer received and confirmed'
                }
            };

            const method = paymentMethods[bookingData.paymentMethod] || paymentMethods.card;
            
            document.getElementById('paymentMethodIcon').innerHTML = `<i class="bi ${method.icon}"></i>`;
            document.getElementById('paymentMethodName').textContent = method.name;
            document.getElementById('paymentMethodDetails').textContent = method.details;
            document.getElementById('paymentStatus').textContent = bookingData.paymentStatus === 'confirmed' ? 'Confirmed' : 'Pending';

            // Update price breakdown
            document.getElementById('subtotalAmount').textContent = `Rs. ${bookingData.subtotal.toLocaleString()}`;
            document.getElementById('serviceFeeAmount').textContent = `Rs. ${bookingData.serviceFee.toLocaleString()}`;
            document.getElementById('processingFeeAmount').textContent = `Rs. ${bookingData.processingFee.toLocaleString()}`;
            document.getElementById('totalPaidAmount').textContent = `Rs. ${bookingData.totalPaid.toLocaleString()}`;

            // Show discount if applied
            if (bookingData.discount > 0) {
                document.getElementById('discountRow').style.display = 'flex';
                document.getElementById('discountAmount').textContent = `-Rs. ${bookingData.discount.toLocaleString()}`;
            }

            // Show points used if any
            if (bookingData.pointsUsed > 0) {
                document.getElementById('pointsRow').style.display = 'flex';
                document.getElementById('pointsAmount').textContent = `-Rs. ${bookingData.pointsUsed.toLocaleString()}`;
            }
        }

        function generateDigitalTickets() {
            const container = document.getElementById('digitalTickets');
            container.innerHTML = ''; // Clear existing content
            
            if (!bookingData || !bookingData.tickets) {
                console.error('No booking data or tickets available');
                return;
            }

            let ticketCounter = 1;
            
            bookingData.tickets.forEach((ticket, ticketIndex) => {
                for (let i = 0; i < ticket.quantity; i++) {
                    const ticketElement = document.createElement('div');
                    ticketElement.className = 'digital-ticket fade-in';
                    ticketElement.style.animationDelay = `${ticketCounter * 0.2}s`;
                    
                    const ticketId = `${ticket.type.substring(0, 3).toUpperCase()}-${String(ticketCounter).padStart(3, '0')}`;
                    const qrData = generateQRData(ticketId);
                    
                    ticketElement.innerHTML = `
                        <div class="ticket-qr" id="qr-${ticketId}"></div>
                        <div class="ticket-info">
                            <h6>${ticket.type} Ticket</h6>
                            <p><strong>${bookingData.eventTitle}</strong></p>
                            <p>${formatEventDate(bookingData.eventDate)}</p>
                            <p>${bookingData.eventTime}</p>
                            <p>${bookingData.eventVenue}</p>
                            <p class="ticket-id">ID: ${ticketId}</p>
                        </div>
                    `;
                    
                    container.appendChild(ticketElement);
                    
                    // Generate QR code with delay to ensure DOM is ready
                    setTimeout(() => {
                        generateQRCode(qrData, `qr-${ticketId}`);
                    }, 200 + (ticketCounter * 100));
                    
                    ticketCounter++;
                }
            });
        }

        function generateQRData(ticketId) {
            return JSON.stringify({
                bookingId: bookingData.bookingId,
                ticketId: ticketId,
                eventId: bookingData.eventId,
                eventTitle: bookingData.eventTitle,
                eventDate: bookingData.eventDate,
                venue: bookingData.eventVenue,
                customerEmail: bookingData.customerEmail,
                validatedAt: null,
                version: '1.0'
            });
        }

        function generateQRCode(data, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            QRCode.toCanvas(container, data, {
                width: 100,
                height: 100,
                margin: 1,
                color: {
                    dark: '#1f2937',
                    light: '#ffffff'
                }
            }, function (error) {
                if (error) {
                    console.error('QR Code generation failed:', error);
                    container.innerHTML = '<div class="text-center p-3"><i class="bi bi-exclamation-triangle text-warning"></i><br><small>QR Code Error</small></div>';
                }
            });
        }

        function setupEventListeners() {
            // Mobile menu auto-close
            const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
            const navbarCollapse = document.querySelector('.navbar-collapse');

            navLinks.forEach(link => {
                link.addEventListener('click', function () {
                    if (window.innerWidth < 992) {
                        const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse) ||
                            new bootstrap.Collapse(navbarCollapse);
                        bsCollapse.hide();
                    }
                });
            });

            // Add animation to cards
            setTimeout(() => {
                document.querySelectorAll('.success-card, .ticket-card, .action-card, .navigation-card').forEach((el, index) => {
                    setTimeout(() => {
                        el.classList.add('fade-in');
                    }, index * 100);
                });
            }, 500);
        }

        function showSuccessNotification() {
            // Show success notification after a short delay
            setTimeout(() => {
                Swal.fire({
                    title: 'Email Sent!',
                    text: 'Your e-tickets have been sent to your email address.',
                    icon: 'success',
                    timer: 3000,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    position: 'top-end',
                    toast: true
                });
            }, 2000);
        }

        function downloadTickets() {
            Swal.fire({
                title: 'Preparing Download...',
                text: 'Your tickets are being prepared for download.',
                icon: 'info',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true
            }).then(() => {
                // In a real application, this would generate and download a PDF
                Swal.fire({
                    title: 'Download Ready!',
                    text: 'Your PDF tickets have been generated.',
                    icon: 'success',
                    confirmButtonColor: '#6366f1',
                    confirmButtonText: 'Great!'
                });
            });
        }

        function emailTickets() {
            Swal.fire({
                title: 'Send Tickets to Email',
                input: 'email',
                inputLabel: 'Email Address',
                inputValue: bookingData.customerEmail,
                inputPlaceholder: 'Enter email address',
                showCancelButton: true,
                confirmButtonText: 'Send Email',
                confirmButtonColor: '#6366f1',
                inputValidator: (value) => {
                    if (!value) {
                        return 'Please enter an email address'
                    }
                    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                        return 'Please enter a valid email address'
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Email Sent!',
                        text: `Tickets have been sent to ${result.value}`,
                        icon: 'success',
                        confirmButtonColor: '#6366f1',
                        timer: 3000,
                        timerProgressBar: true
                    });
                }
            });
        }

        function addToCalendar() {
            const eventDate = new Date(bookingData.eventDate + 'T' + bookingData.eventTime.split(' - ')[0]);
            const endDate = new Date(eventDate.getTime() + 3 * 60 * 60 * 1000); // Add 3 hours
            
            const calendarData = {
                title: bookingData.eventTitle,
                start: eventDate.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z',
                end: endDate.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z',
                description: `Ticket ID: ${bookingData.bookingId}\\n\\nEvent Details:\\n${bookingData.eventTitle}\\nVenue: ${bookingData.eventVenue}\\nTime: ${bookingData.eventTime}`,
                location: bookingData.eventVenue
            };

            const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(calendarData.title)}&dates=${calendarData.start}/${calendarData.end}&details=${encodeURIComponent(calendarData.description)}&location=${encodeURIComponent(calendarData.location)}`;
            
            Swal.fire({
                title: 'Add to Calendar',
                text: 'Choose your preferred calendar service:',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Google Calendar',
                cancelButtonText: 'Download .ics',
                confirmButtonColor: '#6366f1'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.open(googleCalendarUrl, '_blank');
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    downloadICSFile(calendarData);
                }
            });
        }

        function downloadICSFile(data) {
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//EventHub//Event Tickets//EN
BEGIN:VEVENT
UID:${bookingData.bookingId}@eventhub.lk
DTSTAMP:${new Date().toISOString().replace(/[-:]/g, '').split('.')[0]}Z
DTSTART:${data.start}
DTEND:${data.end}
SUMMARY:${data.title}
DESCRIPTION:${data.description}
LOCATION:${data.location}
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${bookingData.eventTitle.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.ics`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            Swal.fire({
                title: 'Calendar File Downloaded!',
                text: 'The event has been saved to your downloads.',
                icon: 'success',
                confirmButtonColor: '#6366f1',
                timer: 3000,
                timerProgressBar: true
            });
        }

        function shareEvent() {
            const shareData = {
                title: bookingData.eventTitle,
                text: `I'm attending ${bookingData.eventTitle}! Check it out:`,
                url: `${window.location.origin}/event-details.html?id=${bookingData.eventId}`
            };

            if (navigator.share) {
                navigator.share(shareData);
            } else {
                Swal.fire({
                    title: 'Share Event',
                    html: `
                        <div class="d-flex justify-content-center gap-3 mt-3">
                            <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareData.url)}" target="_blank" class="btn btn-primary">
                                <i class="bi bi-facebook"></i> Facebook
                            </a>
                            <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(shareData.text)}&url=${encodeURIComponent(shareData.url)}" target="_blank" class="btn btn-info">
                                <i class="bi bi-twitter"></i> Twitter
                            </a>
                            <a href="https://wa.me/?text=${encodeURIComponent(shareData.text + ' ' + shareData.url)}" target="_blank" class="btn btn-success">
                                <i class="bi bi-whatsapp"></i> WhatsApp
                            </a>
                        </div>
                    `,
                    showConfirmButton: false,
                    showCloseButton: true
                });
            }
        }

        function logout() {
            Swal.fire({
                title: 'Sign Out',
                text: 'Are you sure you want to sign out?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, Sign Out',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#ef4444'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Clear session data
                    localStorage.removeItem('userSession');
                    sessionStorage.removeItem('userSession');
                    localStorage.removeItem('userLoggedIn');
                    localStorage.removeItem('userName');
                    localStorage.removeItem('userRole');
                    
                    // Show success message
                    Swal.fire({
                        title: 'Signed Out Successfully',
                        text: 'You have been signed out of your account.',
                        icon: 'success',
                        timer: 2000,
                        timerProgressBar: true,
                        showConfirmButton: false
                    }).then(() => {
                        window.location.href = 'index.html';
                    });
                }
            });
        }

        // Auto-save booking data to localStorage for future reference
        function saveBookingForHistory() {
            if (!bookingData || !currentUser) return;

            let bookingHistory = JSON.parse(localStorage.getItem('bookingHistory') || '[]');
            
            const historyEntry = {
                ...bookingData,
                completedAt: new Date().toISOString(),
                userId: currentUser.email
            };

            bookingHistory.unshift(historyEntry);
            
            // Keep only last 50 bookings
            if (bookingHistory.length > 50) {
                bookingHistory = bookingHistory.slice(0, 50);
            }

            localStorage.setItem('bookingHistory', JSON.stringify(bookingHistory));
        }

        // Initialize page and save booking to history
        if (bookingData && currentUser) {
            saveBookingForHistory();
        }

        // Print functionality
        function printTickets() {
            window.print();
        }

        // Add print button functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add print button to action buttons if not already present
            const actionButtons = document.querySelector('.action-buttons');
            if (actionButtons && !actionButtons.querySelector('.print-btn')) {
                const printButton = document.createElement('button');
                printButton.className = 'btn btn-outline-secondary w-100 mb-3 print-btn';
                printButton.onclick = printTickets;
                printButton.innerHTML = '<i class="bi bi-printer me-2"></i>Print Tickets';
                
                // Insert after download button
                const downloadBtn = actionButtons.querySelector('button');
                if (downloadBtn) {
                    downloadBtn.parentNode.insertBefore(printButton, downloadBtn.nextSibling);
                }
            }
        });

        // Clear any temporary booking data from previous checkout process
        setTimeout(() => {
            sessionStorage.removeItem('currentBooking');
            sessionStorage.removeItem('checkoutDraft');
        }, 5000);
    </script>

</body>

</html>